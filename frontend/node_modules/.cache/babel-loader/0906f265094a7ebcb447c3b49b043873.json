{"ast":null,"code":"import getConfig from './config.js';\nimport NearWalletSelector from \"@near-wallet-selector/core\";\nimport { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\nimport { setupSender } from \"@near-wallet-selector/sender\";\nimport senderIcon from \"./assets/sender-icon.png\";\nimport nearWalletIcon from \"./assets/near-wallet-icon.png\";\nimport { providers } from \"near-api-js\";\nconst nearConfig = getConfig(process.env.VUE_APP_NEAR_ENV || 'testnet');\n\nasync function init() {\n  const walletSelector = window.walletSelector = await NearWalletSelector.init({\n    network: \"testnet\",\n    contractId: nearConfig.contractName,\n    wallets: [setupNearWallet({\n      iconUrl: nearWalletIcon\n    }), setupSender({\n      iconUrl: senderIcon\n    })]\n  });\n  window.provider = new providers.JsonRpcProvider({\n    url: walletSelector.network.nodeUrl\n  });\n  await updateNearAcc();\n}\n\nasync function updateNearAcc() {\n  let currentUser = {\n    accountId: '',\n    balance: 0,\n    isSignedIn: false\n  };\n\n  const setCurrentUser = async () => {\n    let accounts = await window.walletSelector.getAccounts();\n\n    if (Array.isArray(accounts) && accounts.length) {\n      let accountId = accounts[0].accountId;\n      let result = await window.provider.query({\n        request_type: \"view_account\",\n        finality: \"final\",\n        account_id: accountId\n      });\n\n      if (result) {\n        currentUser = {\n          // Gets the accountId as a string\n          accountId: accountId,\n          // Gets the user's token balance\n          balance: result.amount,\n          isSignedIn: await isSignedIn()\n        };\n      }\n    }\n  };\n\n  await setCurrentUser();\n  window.walletSelector.on(\"signIn\", async () => {\n    await setCurrentUser();\n\n    if (currentUser) {\n      document.location.reload();\n    }\n  });\n  window.nearAccount = currentUser;\n}\n\nasync function signIn() {\n  window.walletSelector.show();\n}\n\nasync function signOut() {\n  await window.walletSelector.signOut().then(() => {\n    document.location.reload();\n  }).catch(err => {\n    alert(err);\n  });\n}\n\nasync function isSignedIn() {\n  return window.walletSelector.isSignedIn();\n}\n\nexport { init, signIn, signOut, isSignedIn };","map":{"version":3,"names":["getConfig","NearWalletSelector","setupNearWallet","setupSender","senderIcon","nearWalletIcon","providers","nearConfig","process","env","VUE_APP_NEAR_ENV","init","walletSelector","window","network","contractId","contractName","wallets","iconUrl","provider","JsonRpcProvider","url","nodeUrl","updateNearAcc","currentUser","accountId","balance","isSignedIn","setCurrentUser","accounts","getAccounts","Array","isArray","length","result","query","request_type","finality","account_id","amount","on","document","location","reload","nearAccount","signIn","show","signOut","then","catch","err","alert"],"sources":["/var/www/ch-8-car-renting/frontend/src/utils.js"],"sourcesContent":["import getConfig from './config.js';\n\nimport NearWalletSelector from \"@near-wallet-selector/core\";\nimport {setupNearWallet} from \"@near-wallet-selector/near-wallet\";\nimport {setupSender} from \"@near-wallet-selector/sender\";\nimport senderIcon from \"./assets/sender-icon.png\";\nimport nearWalletIcon from \"./assets/near-wallet-icon.png\";\nimport {providers} from \"near-api-js\";\n\nconst nearConfig = getConfig(process.env.VUE_APP_NEAR_ENV || 'testnet');\n\nasync function init() {\n\n    const walletSelector = window.walletSelector = await NearWalletSelector.init({\n        network: \"testnet\",\n        contractId: nearConfig.contractName,\n        wallets: [\n            setupNearWallet({iconUrl: nearWalletIcon}),\n            setupSender({iconUrl: senderIcon}),\n        ],\n    });\n\n    window.provider = new providers.JsonRpcProvider({\n        url: walletSelector.network.nodeUrl,\n    });\n\n\n    await updateNearAcc();\n\n}\n\nasync function updateNearAcc() {\n    let currentUser = {\n        accountId: '',\n        balance: 0,\n        isSignedIn: false,\n    };\n    const setCurrentUser = async () => {\n        let accounts = await window.walletSelector.getAccounts();\n        if (Array.isArray(accounts) && accounts.length) {\n            let accountId = accounts[0].accountId;\n            let result = await window.provider.query({\n                request_type: \"view_account\",\n                finality: \"final\",\n                account_id: accountId,\n            });\n            if (result) {\n                currentUser = {\n                    // Gets the accountId as a string\n                    accountId: accountId,\n                    // Gets the user's token balance\n                    balance: result.amount,\n                    isSignedIn: await isSignedIn(),\n                };\n            }\n        }\n    }\n    await setCurrentUser();\n    window.walletSelector.on(\"signIn\", async () => {\n        await setCurrentUser();\n        if (currentUser) {\n            document.location.reload();\n        }\n    });\n    window.nearAccount = currentUser;\n}\n\nasync function signIn() {\n    window.walletSelector.show();\n}\n\nasync function signOut() {\n    await window.walletSelector.signOut().then(() => {\n        document.location.reload();\n    }).catch((err) => {\n        alert(err);\n    });\n}\n\nasync function isSignedIn() {\n    return window.walletSelector.isSignedIn();\n}\n\n\n\nexport {\n    init,\n    signIn,\n    signOut,\n    isSignedIn,\n}"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,aAAtB;AAEA,OAAOC,kBAAP,MAA+B,4BAA/B;AACA,SAAQC,eAAR,QAA8B,mCAA9B;AACA,SAAQC,WAAR,QAA0B,8BAA1B;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,OAAOC,cAAP,MAA2B,+BAA3B;AACA,SAAQC,SAAR,QAAwB,aAAxB;AAEA,MAAMC,UAAU,GAAGP,SAAS,CAACQ,OAAO,CAACC,GAAR,CAAYC,gBAAZ,IAAgC,SAAjC,CAA5B;;AAEA,eAAeC,IAAf,GAAsB;EAElB,MAAMC,cAAc,GAAGC,MAAM,CAACD,cAAP,GAAwB,MAAMX,kBAAkB,CAACU,IAAnB,CAAwB;IACzEG,OAAO,EAAE,SADgE;IAEzEC,UAAU,EAAER,UAAU,CAACS,YAFkD;IAGzEC,OAAO,EAAE,CACLf,eAAe,CAAC;MAACgB,OAAO,EAAEb;IAAV,CAAD,CADV,EAELF,WAAW,CAAC;MAACe,OAAO,EAAEd;IAAV,CAAD,CAFN;EAHgE,CAAxB,CAArD;EASAS,MAAM,CAACM,QAAP,GAAkB,IAAIb,SAAS,CAACc,eAAd,CAA8B;IAC5CC,GAAG,EAAET,cAAc,CAACE,OAAf,CAAuBQ;EADgB,CAA9B,CAAlB;EAKA,MAAMC,aAAa,EAAnB;AAEH;;AAED,eAAeA,aAAf,GAA+B;EAC3B,IAAIC,WAAW,GAAG;IACdC,SAAS,EAAE,EADG;IAEdC,OAAO,EAAE,CAFK;IAGdC,UAAU,EAAE;EAHE,CAAlB;;EAKA,MAAMC,cAAc,GAAG,YAAY;IAC/B,IAAIC,QAAQ,GAAG,MAAMhB,MAAM,CAACD,cAAP,CAAsBkB,WAAtB,EAArB;;IACA,IAAIC,KAAK,CAACC,OAAN,CAAcH,QAAd,KAA2BA,QAAQ,CAACI,MAAxC,EAAgD;MAC5C,IAAIR,SAAS,GAAGI,QAAQ,CAAC,CAAD,CAAR,CAAYJ,SAA5B;MACA,IAAIS,MAAM,GAAG,MAAMrB,MAAM,CAACM,QAAP,CAAgBgB,KAAhB,CAAsB;QACrCC,YAAY,EAAE,cADuB;QAErCC,QAAQ,EAAE,OAF2B;QAGrCC,UAAU,EAAEb;MAHyB,CAAtB,CAAnB;;MAKA,IAAIS,MAAJ,EAAY;QACRV,WAAW,GAAG;UACV;UACAC,SAAS,EAAEA,SAFD;UAGV;UACAC,OAAO,EAAEQ,MAAM,CAACK,MAJN;UAKVZ,UAAU,EAAE,MAAMA,UAAU;QALlB,CAAd;MAOH;IACJ;EACJ,CAnBD;;EAoBA,MAAMC,cAAc,EAApB;EACAf,MAAM,CAACD,cAAP,CAAsB4B,EAAtB,CAAyB,QAAzB,EAAmC,YAAY;IAC3C,MAAMZ,cAAc,EAApB;;IACA,IAAIJ,WAAJ,EAAiB;MACbiB,QAAQ,CAACC,QAAT,CAAkBC,MAAlB;IACH;EACJ,CALD;EAMA9B,MAAM,CAAC+B,WAAP,GAAqBpB,WAArB;AACH;;AAED,eAAeqB,MAAf,GAAwB;EACpBhC,MAAM,CAACD,cAAP,CAAsBkC,IAAtB;AACH;;AAED,eAAeC,OAAf,GAAyB;EACrB,MAAMlC,MAAM,CAACD,cAAP,CAAsBmC,OAAtB,GAAgCC,IAAhC,CAAqC,MAAM;IAC7CP,QAAQ,CAACC,QAAT,CAAkBC,MAAlB;EACH,CAFK,EAEHM,KAFG,CAEIC,GAAD,IAAS;IACdC,KAAK,CAACD,GAAD,CAAL;EACH,CAJK,CAAN;AAKH;;AAED,eAAevB,UAAf,GAA4B;EACxB,OAAOd,MAAM,CAACD,cAAP,CAAsBe,UAAtB,EAAP;AACH;;AAID,SACIhB,IADJ,EAEIkC,MAFJ,EAGIE,OAHJ,EAIIpB,UAJJ"},"metadata":{},"sourceType":"module"}