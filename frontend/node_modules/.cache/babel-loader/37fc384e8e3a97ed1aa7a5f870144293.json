{"ast":null,"code":"import { getTransactionState, getUrlParams } from \"../../../helpers\";\nimport Big from \"big.js\";\nexport default {\n  name: \"CarListItemComponent\",\n  props: ['id', 'title', 'description', 'image', 'owner_id', 'price_per_month', 'is_rent', 'stream_id', 'rent'],\n  methods: {\n    async continueCancelRentCarProcess() {\n      let loader = this.$loading.show();\n      let params = getUrlParams();\n      let transactionHashes = params.get('transactionHashes');\n\n      if (transactionHashes !== null) {\n        let result = await getTransactionState(transactionHashes);\n\n        if (\"SuccessValue\" in result.status) {\n          const transactionMethodName = result.transaction.actions[0].FunctionCall.method_name;\n\n          switch (transactionMethodName) {\n            case 'stop_stream':\n              this.$swal.fire({\n                icon: 'success',\n                title: 'Success',\n                text: 'Car rent was canceled!',\n                footer: ``\n              });\n              this.cleanGetParams();\n              break;\n          }\n        }\n      }\n\n      loader.hide();\n    },\n\n    cleanGetParams() {\n      window.history.pushState({}, document.title, process.env.VUE_APP_APP_URL + '#' + this.$route.fullPath);\n    },\n\n    async startCancelRentCarProcess() {\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.nearConfig.contractName,\n        methodName: 'stop_rent_car',\n        args: {\n          \"car_id\": +this.id\n        },\n        gas: \"200000000000000\"\n      }).then(response => {\n        window.walletConnection.account().functionCall({\n          contractId: window.roketoContractName,\n          methodName: 'stop_stream',\n          args: {\n            \"stream_id\": this.stream_id\n          },\n          gas: \"200000000000000\",\n          attachedDeposit: 1\n        }).then(response => {\n          console.log(response);\n        });\n      });\n      loader.hide();\n    }\n\n  },\n\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.continueCancelRentCarProcess();\n    loader.hide();\n  },\n\n  computed: {\n    alreadyPaid() {\n      let currentTimestamp = +new Date();\n      console.log(currentTimestamp);\n      let rentTimestamp = new Date();\n      rentTimestamp.setTime(this.rent.timestamp_created.toString().substring(0, 13));\n      console.log(+rentTimestamp);\n      let secondsLeft = (currentTimestamp - rentTimestamp) / 10 ** 6;\n      console.log(secondsLeft);\n      return 1;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["getTransactionState","getUrlParams","Big","name","props","methods","continueCancelRentCarProcess","loader","$loading","show","params","transactionHashes","get","result","status","transactionMethodName","transaction","actions","FunctionCall","method_name","$swal","fire","icon","title","text","footer","cleanGetParams","hide","window","history","pushState","document","process","env","VUE_APP_APP_URL","$route","fullPath","startCancelRentCarProcess","walletConnection","account","functionCall","contractId","nearConfig","contractName","methodName","args","id","gas","then","response","roketoContractName","stream_id","attachedDeposit","console","log","mounted","computed","alreadyPaid","currentTimestamp","Date","rentTimestamp","setTime","rent","timestamp_created","toString","substring","secondsLeft"],"sourceRoot":"","sources":["/var/www/ch-8-car-renting/frontend/src/components/Pages/CarListItemComponent.vue"],"sourcesContent":["<template>\n  <div class=\"col-4 mb-4\">\n    <div class=\"card\">\n      <img :src=\"image\" class=\"card-img-top\" alt=\"...\" style=\"height: 250px\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">{{ title }}</h5>\n        <p class=\"card-text\">{{description}}</p>\n      </div>\n      <ul class=\"list-group list-group-flush\">\n        <li class=\"list-group-item d-flex justify-content-between\"><span>Owner:</span><span>{{owner_id}}</span></li>\n        <li class=\"list-group-item d-flex justify-content-between\"><span>Price per hour:</span><span>{{$filters.formatYoctoNearToNear(price_per_month)}} Ⓝ</span></li>\n      </ul>\n      <router-link :to=\"{name:'car-single',params:{id:id}}\" class=\"btn btn-primary\">Go to car page</router-link>\n      <div v-if=\"is_rent\">\n        <hr>\n        <ul class=\"list-group list-group-flush\">\n          <li class=\"list-group-item d-flex justify-content-between\"><span>Price per hour:</span><span>{{$filters.formatYoctoNearToNear(alreadyPaid)}} Ⓝ</span></li>\n        </ul>\n        <button class=\"btn btn-danger w-100\" @click.prevent=\"startCancelRentCarProcess\">Cancel renting</button>\n      </div>\n\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport {getTransactionState, getUrlParams} from \"../../../helpers\";\nimport Big from \"big.js\";\n\nexport default {\n  name: \"CarListItemComponent\",\n  props: [\n    'id',\n    'title',\n    'description',\n    'image',\n    'owner_id',\n    'price_per_month',\n    'is_rent',\n    'stream_id',\n    'rent',\n  ],\n  methods:{\n\n    async continueCancelRentCarProcess() {\n      let loader = this.$loading.show();\n      let params = getUrlParams();\n      let transactionHashes = params.get('transactionHashes');\n      if (transactionHashes !== null){\n        let result = await getTransactionState(transactionHashes);\n        if (\"SuccessValue\" in result.status){\n          const transactionMethodName = result.transaction.actions[0].FunctionCall.method_name;\n          switch (transactionMethodName){\n            case 'stop_stream':\n              this.$swal.fire({\n                icon: 'success',\n                title: 'Success',\n                text: 'Car rent was canceled!',\n                footer: ``,\n              })\n              this.cleanGetParams();\n              break;\n\n          }\n        }\n      }\n      loader.hide();\n    },\n    cleanGetParams(){\n      window.history.pushState({}, document.title, process.env.VUE_APP_APP_URL + '#' + this.$route.fullPath);\n    },\n    async startCancelRentCarProcess(){\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.nearConfig.contractName,\n        methodName: 'stop_rent_car',\n        args: {\"car_id\": +this.id},\n        gas:\"200000000000000\",\n      }).then((response)=>{\n        window.walletConnection.account().functionCall({\n          contractId: window.roketoContractName,\n          methodName: 'stop_stream',\n          args: {\"stream_id\": this.stream_id},\n          gas:\"200000000000000\",\n          attachedDeposit:1,\n        }).then((response)=>{\n          console.log(response)\n        });\n      });\n      loader.hide();\n    },\n  },\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.continueCancelRentCarProcess()\n    loader.hide()\n  },\n  computed:{\n    alreadyPaid(){\n      let currentTimestamp = (+ new Date());\n      console.log(currentTimestamp)\n      let rentTimestamp = new Date;\n      rentTimestamp.setTime(this.rent.timestamp_created.toString().substring(0,13));\n      console.log(+rentTimestamp)\n      let secondsLeft = (currentTimestamp - rentTimestamp) / 10**6;\n      console.log(secondsLeft)\n      return 1;\n    }\n  }\n\n}\n</script>\n\n<style scoped>\n\n</style>"]},"metadata":{},"sourceType":"module"}