"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[453],{6759:function(t,e,n){n.d(e,{D:function(){return r},a:function(){return s}});var a=n(9049);function s(){let t=window.location.search.substring(1);return new URLSearchParams(t)}async function r(t){const e=new a.providers.JsonRpcProvider("https://archival-rpc.testnet.near.org");return await e.txStatus(t,window.nearAccount.accountId)}},736:function(t,e,n){n.d(e,{Z:function(){return R}});var a=n(3396),s=n(7139),r=n(9242);const i={class:"col-4 mb-4"},o={class:"card"},c=["src"],l={class:"card-body"},d={class:"card-title"},u={class:"card-text"},p={class:"list-group list-group-flush"},m={class:"list-group-item d-flex justify-content-between"},w=(0,a._)("span",null,"Owner:",-1),h={class:"list-group-item d-flex justify-content-between"},_=(0,a._)("span",null,"Price per month:",-1),g=(0,a.Uk)("Go to car page"),f={key:0},C=(0,a._)("hr",null,null,-1),y={class:"list-group list-group-flush"},v={class:"list-group-item d-flex justify-content-between"},b=(0,a._)("span",null,"Already paid:",-1);function k(t,e,n,k,P,N){const D=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",o,[(0,a._)("img",{src:n.image,class:"card-img-top",alt:"...",style:{height:"250px"}},null,8,c),(0,a._)("div",l,[(0,a._)("h5",d,(0,s.zw)(n.title),1),(0,a._)("p",u,(0,s.zw)(n.description),1)]),(0,a._)("ul",p,[(0,a._)("li",m,[w,(0,a._)("span",null,(0,s.zw)(n.owner_id),1)]),(0,a._)("li",h,[_,(0,a._)("span",null,(0,s.zw)(t.$filters.formatYoctoNearToNear(n.price_per_month))+" Ⓝ",1)])]),(0,a.Wm)(D,{to:{name:"car-single",params:{id:n.id}},class:"btn btn-primary"},{default:(0,a.w5)((()=>[g])),_:1},8,["to"]),n.is_rent?((0,a.wg)(),(0,a.iD)("div",f,[C,(0,a._)("ul",y,[(0,a._)("li",v,[b,(0,a._)("span",null,(0,s.zw)(t.$filters.formatYoctoNearToNear(N.alreadyPaid))+" Ⓝ",1)])]),(0,a._)("button",{class:"btn btn-danger w-100",onClick:e[0]||(e[0]=(0,r.iM)(((...t)=>N.startCancelRentCarProcess&&N.startCancelRentCarProcess(...t)),["prevent"]))},"Cancel renting")])):(0,a.kq)("",!0)])])}var P=n(6759),N=(n(5648),{name:"CarListItemComponent",props:["id","title","description","image","owner_id","price_per_month","is_rent","stream_id","rent"],methods:{async continueCancelRentCarProcess(){let t=this.$loading.show(),e=(0,P.a)(),n=e.get("transactionHashes");if(null!==n){let t=await(0,P.D)(n);if("SuccessValue"in t.status){const e=t.transaction.actions[0].FunctionCall.method_name;switch(e){case"stop_stream":this.$swal.fire({icon:"success",title:"Success",text:"Car rent was canceled!",footer:""}),this.cleanGetParams();break}}}t.hide()},cleanGetParams(){window.history.pushState({},document.title,"https://vitaliksokil.github.io/ch-8-car-renting/#/ch-8-car-renting#"+this.$route.fullPath)},async startCancelRentCarProcess(){let t=this.$loading.show();window.walletConnection.account().functionCall({contractId:window.nearConfig.contractName,methodName:"stop_rent_car",args:{car_id:+this.id},gas:"200000000000000"}).then((t=>{window.walletConnection.account().functionCall({contractId:window.roketoContractName,methodName:"stop_stream",args:{stream_id:this.stream_id},gas:"200000000000000",attachedDeposit:1}).then((t=>{console.log(t)}))})),t.hide()}},async mounted(){let t=this.$loading.show();await this.continueCancelRentCarProcess(),t.hide()},computed:{alreadyPaid(){let t=+new Date;console.log(t);let e=new Date;e.setTime(this.rent.timestamp_created.toString().substring(0,13)),console.log(+e);let n=((t-e)/1e3).toFixed();return n*this.rent.tokens_per_sec}}}),D=n(89);const x=(0,D.Z)(N,[["render",k]]);var R=x},3453:function(t,e,n){n.r(e),n.d(e,{default:function(){return w}});var a=n(3396);const s={class:"site-section p-4"},r={class:"container"},i={class:"row"};function o(t,e,n,o,c,l){const d=(0,a.up)("car-list-item-component");return(0,a.wg)(),(0,a.iD)("section",s,[(0,a._)("div",r,[(0,a._)("div",i,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(c.cars,((t,e)=>((0,a.wg)(),(0,a.j4)(d,{key:e,id:e,title:t.title,description:t.description,image:t.image,owner_id:t.owner_id,price_per_month:t.price_per_month},null,8,["id","title","description","image","owner_id","price_per_month"])))),128))])])])}var c=n(9049),l=n(736),d=n(5361)["Buffer"],u={name:"CarsComponent",components:{CarListItemComponent:l.Z},data(){return{cars:{}}},methods:{async getAllCars(){const t=new c.providers.JsonRpcProvider(window.nearConfig.nodeUrl),e=await t.query({request_type:"call_function",finality:"final",account_id:window.nearConfig.contractName,method_name:"get_all_cars",args_base64:""});this.cars=JSON.parse(d.from(e.result).toString())}},async mounted(){let t=this.$loading.show();await this.getAllCars(),t.hide()}},p=n(89);const m=(0,p.Z)(u,[["render",o]]);var w=m}}]);
//# sourceMappingURL=453.8e381db0.js.map