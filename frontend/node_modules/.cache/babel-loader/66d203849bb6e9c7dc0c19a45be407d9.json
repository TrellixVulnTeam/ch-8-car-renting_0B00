{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport CarListItemComponent from \"@/components/Pages/CarListItemComponent\";\nimport * as nearAPI from \"near-api-js\";\nimport { getTransactionState, getUrlParams } from \"../../../helpers\";\nimport Big from \"big.js\";\nexport default {\n  name: \"MyRentsComponent\",\n  components: {\n    CarListItemComponent\n  },\n\n  data() {\n    return {\n      cars: {}\n    };\n  },\n\n  methods: {\n    async getStream(stream_id) {\n      console.log(stream_id);\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({\n        \"stream_id\": stream_id\n      }));\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.roketoContractName,\n        method_name: \"get_stream\",\n        args_base64: argsBase64\n      });\n      return JSON.parse(Buffer.from(rawResult.result).toString());\n    },\n\n    async getMyCars() {\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({\n        renter_account_id: window.nearAccount.accountId\n      }));\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.nearConfig.contractName,\n        method_name: \"get_rents_by_renter_id\",\n        args_base64: argsBase64\n      });\n      let cars = JSON.parse(Buffer.from(rawResult.result).toString());\n      console.log(cars);\n      let result = [];\n\n      for (const [key, value] of Object.entries(cars)) {\n        result.push({\n          car: value.car,\n          rent: await this.getStream(value.rent.stream_id)\n        });\n      }\n\n      this.cars = result;\n      console.log(result);\n    }\n\n  },\n\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.getMyCars();\n    loader.hide();\n  }\n\n};","map":{"version":3,"mappings":";AAyBA,OAAOA,oBAAP,MAAiC,yCAAjC;AACA,OAAO,KAAKC,OAAZ,MAAyB,aAAzB;AACA,SAAQC,mBAAR,EAA6BC,YAA7B,QAAgD,kBAAhD;AACA,OAAOC,GAAP,MAAgB,QAAhB;AAEA,eAAe;EACbC,IAAI,EAAE,kBADO;EAEbC,UAAU,EAAC;IACTN;EADS,CAFE;;EAKbO,IAAI,GAAE;IACJ,OAAO;MACLC,IAAG,EAAI;IADF,CAAP;EAGD,CATY;;EAUbC,OAAO,EAAC;IACN,MAAMC,SAAN,CAAgBC,SAAhB,EAA0B;MACxBC,OAAO,CAACC,GAAR,CAAYF,SAAZ;MACA,MAAMG,QAAO,GAAI,IAAIb,OAAO,CAACc,SAAR,CAAkBC,eAAtB,CAAsCC,MAAM,CAACC,UAAP,CAAkBC,OAAxD,CAAjB;MACA,MAAMC,UAAS,GAAIH,MAAM,CAACI,IAAP,CAAYC,IAAI,CAACC,SAAL,CAAe;QAAC,aAAYZ;MAAb,CAAf,CAAZ,CAAnB;MACA,MAAMa,SAAQ,GAAI,MAAMV,QAAQ,CAACW,KAAT,CAAe;QACrCC,YAAY,EAAE,eADuB;QAErCC,QAAQ,EAAE,OAF2B;QAGrCC,UAAU,EAAEX,MAAM,CAACY,kBAHkB;QAIrCC,WAAW,EAAE,YAJwB;QAKrCC,WAAW,EAAEX;MALwB,CAAf,CAAxB;MAOA,OAAOE,IAAI,CAACU,KAAL,CAAWC,MAAM,CAACC,IAAP,CAAYV,SAAS,CAACW,MAAtB,EAA8BC,QAA9B,EAAX,CAAP;IACD,CAbK;;IAcN,MAAMC,SAAN,GAAiB;MACf,MAAMvB,QAAO,GAAI,IAAIb,OAAO,CAACc,SAAR,CAAkBC,eAAtB,CAAsCC,MAAM,CAACC,UAAP,CAAkBC,OAAxD,CAAjB;MACA,MAAMC,UAAS,GAAIH,MAAM,CAACI,IAAP,CAAYC,IAAI,CAACC,SAAL,CAAe;QAACe,iBAAiB,EAACrB,MAAM,CAACsB,WAAP,CAAmBC;MAAtC,CAAf,CAAZ,CAAnB;MACA,MAAMhB,SAAQ,GAAI,MAAMV,QAAQ,CAACW,KAAT,CAAe;QACrCC,YAAY,EAAE,eADuB;QAErCC,QAAQ,EAAE,OAF2B;QAGrCC,UAAU,EAAEX,MAAM,CAACC,UAAP,CAAkBuB,YAHO;QAIrCX,WAAW,EAAE,wBAJwB;QAKrCC,WAAW,EAAEX;MALwB,CAAf,CAAxB;MAOA,IAAIZ,IAAG,GAAIc,IAAI,CAACU,KAAL,CAAWC,MAAM,CAACC,IAAP,CAAYV,SAAS,CAACW,MAAtB,EAA8BC,QAA9B,EAAX,CAAX;MACAxB,OAAO,CAACC,GAAR,CAAYL,IAAZ;MACA,IAAI2B,MAAK,GAAI,EAAb;;MACA,KAAK,MAAM,CAACO,GAAD,EAAMC,KAAN,CAAX,IAA2BC,MAAM,CAACC,OAAP,CAAerC,IAAf,CAA3B,EAAiD;QAC/C2B,MAAM,CAACW,IAAP,CAAY;UACVC,GAAG,EAACJ,KAAK,CAACI,GADA;UAEVC,IAAI,EAAE,MAAM,KAAKtC,SAAL,CAAeiC,KAAK,CAACK,IAAN,CAAWrC,SAA1B;QAFF,CAAZ;MAIF;;MACA,KAAKH,IAAL,GAAY2B,MAAZ;MACAvB,OAAO,CAACC,GAAR,CAAYsB,MAAZ;IACD;;EAnCK,CAVK;;EAiDb,MAAMc,OAAN,GAAgB;IACd,IAAIC,MAAK,GAAI,KAAKC,QAAL,CAAcC,IAAd,EAAb;IACA,MAAM,KAAKf,SAAL,EAAN;IACAa,MAAM,CAACG,IAAP;EACD;;AArDY,CAAf","names":["CarListItemComponent","nearAPI","getTransactionState","getUrlParams","Big","name","components","data","cars","methods","getStream","stream_id","console","log","provider","providers","JsonRpcProvider","window","nearConfig","nodeUrl","argsBase64","btoa","JSON","stringify","rawResult","query","request_type","finality","account_id","roketoContractName","method_name","args_base64","parse","Buffer","from","result","toString","getMyCars","renter_account_id","nearAccount","accountId","contractName","key","value","Object","entries","push","car","rent","mounted","loader","$loading","show","hide"],"sourceRoot":"","sources":["/var/www/ch-8-car-renting/frontend/src/components/Pages/MyRentsComponent.vue"],"sourcesContent":["<template>\n  <section class=\"site-section p-4\">\n    <div class=\"container\">\n\n      <div class=\"row\">\n        <car-list-item-component v-for=\"(car,key) in cars\" :key=\"key\"\n                                 :id=\"key\"\n                                 :title=\"car.car.title\"\n                                 :description=\"car.car.description\"\n                                 :image=\"car.car.image\"\n                                 :owner_id=\"car.car.owner_id\"\n                                 :price_per_month=\"car.car.price_per_month\"\n                                 is_rent=\"true\"\n                                 :stream_id=\"car.rent.id\"\n                                 :already_paid=\"car.rent.balance\"\n        >\n\n        </car-list-item-component>\n\n      </div>\n    </div>\n  </section>\n</template>\n\n<script>\nimport CarListItemComponent from \"@/components/Pages/CarListItemComponent\";\nimport * as nearAPI from \"near-api-js\";\nimport {getTransactionState, getUrlParams} from \"../../../helpers\";\nimport Big from \"big.js\";\n\nexport default {\n  name: \"MyRentsComponent\",\n  components:{\n    CarListItemComponent\n  },\n  data(){\n    return {\n      cars : {}\n    }\n  },\n  methods:{\n    async getStream(stream_id){\n      console.log(stream_id)\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({\"stream_id\":stream_id}))\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.roketoContractName,\n        method_name: \"get_stream\",\n        args_base64: argsBase64,\n      });\n      return JSON.parse(Buffer.from(rawResult.result).toString())\n    },\n    async getMyCars(){\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({renter_account_id:window.nearAccount.accountId}))\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.nearConfig.contractName,\n        method_name: \"get_rents_by_renter_id\",\n        args_base64: argsBase64,\n      });\n      let cars = JSON.parse(Buffer.from(rawResult.result).toString())\n      console.log(cars)\n      let result = [];\n      for (const [key, value] of Object.entries(cars)) {\n        result.push({\n          car:value.car,\n          rent: await this.getStream(value.rent.stream_id)\n        })\n      }\n      this.cars = result;\n      console.log(result)\n    },\n\n\n  },\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.getMyCars()\n    loader.hide()\n  },\n\n}\n</script>\n\n<style scoped>\n\n</style>"]},"metadata":{},"sourceType":"module"}