(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[595],{5787:function(t,r,e){var n=e(7854),o=e(7976),s=n.TypeError;t.exports=function(t,r){if(o(r,t))return t;throw s("Incorrect invocation")}},3678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},2801:function(t,r,e){"use strict";var n=e(2109),o=e(5005),s=e(9114),a=e(3070).f,i=e(2597),c=e(5787),l=e(9587),d=e(6277),u=e(3678),_=e(7741),m=e(1913),E="DOMException",p=o("Error"),w=o(E),R=function(){c(this,h);var t=arguments.length,r=d(t<1?void 0:arguments[0]),e=d(t<2?void 0:arguments[1],"Error"),n=new w(r,e),o=p(r);return o.name=E,a(n,"stack",s(1,_(o.stack,1))),l(n,this,R),n},h=R.prototype=w.prototype,f="stack"in p(E),g="stack"in new w(1,2),C=f&&!g;n({global:!0,forced:m||C},{DOMException:C?R:w});var I=o(E),N=I.prototype;if(N.constructor!==I)for(var A in m||a(N,"constructor",s(1,I)),u)if(i(u,A)){var y=u[A],D=y.s;i(I,D)||a(I,D,s(6,y.c))}},6759:function(t,r,e){"use strict";e.d(r,{D:function(){return s},a:function(){return o}});var n=e(9049);function o(){let t=window.location.search.substring(1);return new URLSearchParams(t)}async function s(t){const r=new n.providers.JsonRpcProvider("https://archival-rpc.testnet.near.org");return await r.txStatus(t,window.nearAccount.accountId)}},736:function(t,r,e){"use strict";e.d(r,{Z:function(){return v}});var n=e(3396),o=e(7139),s=e(9242);const a={class:"col-4 mb-4"},i={class:"card"},c=["src"],l={class:"card-body"},d={class:"card-title"},u={class:"card-text"},_={class:"list-group list-group-flush"},m={class:"list-group-item d-flex justify-content-between"},E=(0,n._)("span",null,"Owner:",-1),p={class:"list-group-item d-flex justify-content-between"},w=(0,n._)("span",null,"Price per month:",-1),R=(0,n.Uk)("Go to car page"),h={key:0},f=(0,n._)("hr",null,null,-1),g={class:"list-group list-group-flush"},C={class:"list-group-item d-flex justify-content-between"},I=(0,n._)("span",null,"Already paid:",-1);function N(t,r,e,N,A,y){const D=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("div",i,[(0,n._)("img",{src:e.image,class:"card-img-top",alt:"...",style:{height:"250px"}},null,8,c),(0,n._)("div",l,[(0,n._)("h5",d,(0,o.zw)(e.title),1),(0,n._)("p",u,(0,o.zw)(e.description),1)]),(0,n._)("ul",_,[(0,n._)("li",m,[E,(0,n._)("span",null,(0,o.zw)(e.owner_id),1)]),(0,n._)("li",p,[w,(0,n._)("span",null,(0,o.zw)(t.$filters.formatYoctoNearToNear(e.price_per_month))+" Ⓝ",1)])]),(0,n.Wm)(D,{to:{name:"car-single",params:{id:e.id}},class:"btn btn-primary"},{default:(0,n.w5)((()=>[R])),_:1},8,["to"]),e.is_rent?((0,n.wg)(),(0,n.iD)("div",h,[f,(0,n._)("ul",g,[(0,n._)("li",C,[I,(0,n._)("span",null,(0,o.zw)(t.$filters.formatYoctoNearToNear(y.alreadyPaid))+" Ⓝ",1)])]),(0,n._)("button",{class:"btn btn-danger w-100",onClick:r[0]||(r[0]=(0,s.iM)(((...t)=>y.startCancelRentCarProcess&&y.startCancelRentCarProcess(...t)),["prevent"]))},"Cancel renting")])):(0,n.kq)("",!0)])])}var A=e(6759),y=(e(5648),{name:"CarListItemComponent",props:["id","title","description","image","owner_id","price_per_month","is_rent","stream_id","rent"],methods:{async continueCancelRentCarProcess(){let t=this.$loading.show(),r=(0,A.a)(),e=r.get("transactionHashes");if(null!==e){let t=await(0,A.D)(e);if("SuccessValue"in t.status){const r=t.transaction.actions[0].FunctionCall.method_name;switch(r){case"stop_stream":this.$swal.fire({icon:"success",title:"Success",text:"Car rent was canceled!",footer:""}),this.cleanGetParams();break}}}t.hide()},cleanGetParams(){window.history.pushState({},document.title,"https://vitaliksokil.github.io/ch-8-car-renting/#/ch-8-car-renting#"+this.$route.fullPath)},async startCancelRentCarProcess(){let t=this.$loading.show();window.walletConnection.account().functionCall({contractId:window.nearConfig.contractName,methodName:"stop_rent_car",args:{car_id:+this.id},gas:"200000000000000"}).then((t=>{window.walletConnection.account().functionCall({contractId:window.roketoContractName,methodName:"stop_stream",args:{stream_id:this.stream_id},gas:"200000000000000",attachedDeposit:1}).then((t=>{console.log(t)}))})),t.hide()}},async mounted(){let t=this.$loading.show();await this.continueCancelRentCarProcess(),t.hide()},computed:{alreadyPaid(){let t=+new Date;console.log(t);let r=new Date;r.setTime(this.rent.timestamp_created.toString().substring(0,13)),console.log(+r);let e=((t-r)/1e3).toFixed();return e*this.rent.tokens_per_sec}}}),D=e(89);const T=(0,D.Z)(y,[["render",N]]);var v=T},7595:function(t,r,e){"use strict";e.r(r),e.d(r,{default:function(){return E}});var n=e(3396);const o={class:"site-section p-4"},s={class:"container"},a={class:"row"};function i(t,r,e,i,c,l){const d=(0,n.up)("car-list-item-component");return(0,n.wg)(),(0,n.iD)("section",o,[(0,n._)("div",s,[(0,n._)("div",a,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.cars,((t,r)=>((0,n.wg)(),(0,n.j4)(d,{key:r,id:r,title:t.title,description:t.description,image:t.image,owner_id:t.owner_id,price_per_month:t.price_per_month},null,8,["id","title","description","image","owner_id","price_per_month"])))),128))])])])}e(2801);var c=e(736),l=e(9049),d=e(5361)["Buffer"],u={name:"MyCarsComponent",components:{CarListItemComponent:c.Z},data(){return{cars:{}}},methods:{async getMyCars(){const t=new l.providers.JsonRpcProvider(window.nearConfig.nodeUrl),r=window.btoa(JSON.stringify({owner_account_id:window.nearAccount.accountId})),e=await t.query({request_type:"call_function",finality:"final",account_id:window.nearConfig.contractName,method_name:"get_cars_by_owner_id",args_base64:r});this.cars=JSON.parse(d.from(e.result).toString())}},async mounted(){let t=this.$loading.show();await this.getMyCars(),t.hide()}},_=e(89);const m=(0,_.Z)(u,[["render",i]]);var E=m}}]);
//# sourceMappingURL=595.8d2c27a0.js.map