{"ast":null,"code":"import getConfig from './config.js';\nimport * as nearAPI from 'near-api-js';\nimport { providers } from \"near-api-js\";\nconst nearConfig = getConfig(process.env.VUE_APP_NEAR_ENV || 'testnet');\n\nasync function init() {\n  // create a keyStore for signing transactions using the user's key\n  // which is located in the browser local storage after user logs in\n  const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore(); // Initializing connection to the NEAR testnet\n\n  const near = await nearAPI.connect({\n    keyStore,\n    ...nearConfig\n  }); // Initialize wallet connection\n\n  window.walletConnection = new nearAPI.WalletConnection(near);\n  await updateNearAcc();\n}\n\nasync function updateNearAcc() {\n  let currentUser = {\n    accountId: '',\n    balance: 0,\n    isSignedIn: false\n  };\n\n  const setCurrentUser = async () => {\n    let accounts = await window.walletSelector.getAccounts();\n\n    if (Array.isArray(accounts) && accounts.length) {\n      let accountId = accounts[0].accountId;\n      let result = await window.provider.query({\n        request_type: \"view_account\",\n        finality: \"final\",\n        account_id: accountId\n      });\n\n      if (result) {\n        currentUser = {\n          // Gets the accountId as a string\n          accountId: accountId,\n          // Gets the user's token balance\n          balance: result.amount,\n          isSignedIn: await isSignedIn()\n        };\n      }\n    }\n  };\n\n  await setCurrentUser();\n  window.walletSelector.on(\"signIn\", async () => {\n    await setCurrentUser();\n\n    if (currentUser) {\n      document.location.reload();\n    }\n  });\n  window.nearAccount = currentUser;\n}\n\nasync function signIn() {\n  window.walletSelector.show();\n}\n\nasync function signOut() {\n  await window.walletSelector.signOut().then(() => {\n    document.location.reload();\n  }).catch(err => {\n    alert(err);\n  });\n}\n\nasync function isSignedIn() {\n  return window.walletSelector.isSignedIn();\n}\n\nexport { init, signIn, signOut, isSignedIn };","map":{"version":3,"names":["getConfig","nearAPI","providers","nearConfig","process","env","VUE_APP_NEAR_ENV","init","keyStore","keyStores","BrowserLocalStorageKeyStore","near","connect","window","walletConnection","WalletConnection","updateNearAcc","currentUser","accountId","balance","isSignedIn","setCurrentUser","accounts","walletSelector","getAccounts","Array","isArray","length","result","provider","query","request_type","finality","account_id","amount","on","document","location","reload","nearAccount","signIn","show","signOut","then","catch","err","alert"],"sources":["/var/www/ch-8-car-renting/frontend/src/utils.js"],"sourcesContent":["import getConfig from './config.js';\nimport * as nearAPI from 'near-api-js';\nimport {providers} from \"near-api-js\";\n\nconst nearConfig = getConfig(process.env.VUE_APP_NEAR_ENV || 'testnet');\n\nasync function init() {\n\n    // create a keyStore for signing transactions using the user's key\n// which is located in the browser local storage after user logs in\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n\n// Initializing connection to the NEAR testnet\n    const near = await nearAPI.connect({keyStore, ...nearConfig});\n\n// Initialize wallet connection\n    window.walletConnection = new nearAPI.WalletConnection(near);\n\n    await updateNearAcc();\n\n}\n\nasync function updateNearAcc() {\n    let currentUser = {\n        accountId: '',\n        balance: 0,\n        isSignedIn: false,\n    };\n    const setCurrentUser = async () => {\n        let accounts = await window.walletSelector.getAccounts();\n        if (Array.isArray(accounts) && accounts.length) {\n            let accountId = accounts[0].accountId;\n            let result = await window.provider.query({\n                request_type: \"view_account\",\n                finality: \"final\",\n                account_id: accountId,\n            });\n            if (result) {\n                currentUser = {\n                    // Gets the accountId as a string\n                    accountId: accountId,\n                    // Gets the user's token balance\n                    balance: result.amount,\n                    isSignedIn: await isSignedIn(),\n                };\n            }\n        }\n    }\n    await setCurrentUser();\n    window.walletSelector.on(\"signIn\", async () => {\n        await setCurrentUser();\n        if (currentUser) {\n            document.location.reload();\n        }\n    });\n    window.nearAccount = currentUser;\n}\n\nasync function signIn() {\n    window.walletSelector.show();\n}\n\nasync function signOut() {\n    await window.walletSelector.signOut().then(() => {\n        document.location.reload();\n    }).catch((err) => {\n        alert(err);\n    });\n}\n\nasync function isSignedIn() {\n    return window.walletSelector.isSignedIn();\n}\n\n\n\nexport {\n    init,\n    signIn,\n    signOut,\n    isSignedIn,\n}"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,aAAtB;AACA,OAAO,KAAKC,OAAZ,MAAyB,aAAzB;AACA,SAAQC,SAAR,QAAwB,aAAxB;AAEA,MAAMC,UAAU,GAAGH,SAAS,CAACI,OAAO,CAACC,GAAR,CAAYC,gBAAZ,IAAgC,SAAjC,CAA5B;;AAEA,eAAeC,IAAf,GAAsB;EAElB;EACJ;EACI,MAAMC,QAAQ,GAAG,IAAIP,OAAO,CAACQ,SAAR,CAAkBC,2BAAtB,EAAjB,CAJkB,CAMtB;;EACI,MAAMC,IAAI,GAAG,MAAMV,OAAO,CAACW,OAAR,CAAgB;IAACJ,QAAD;IAAW,GAAGL;EAAd,CAAhB,CAAnB,CAPkB,CAStB;;EACIU,MAAM,CAACC,gBAAP,GAA0B,IAAIb,OAAO,CAACc,gBAAZ,CAA6BJ,IAA7B,CAA1B;EAEA,MAAMK,aAAa,EAAnB;AAEH;;AAED,eAAeA,aAAf,GAA+B;EAC3B,IAAIC,WAAW,GAAG;IACdC,SAAS,EAAE,EADG;IAEdC,OAAO,EAAE,CAFK;IAGdC,UAAU,EAAE;EAHE,CAAlB;;EAKA,MAAMC,cAAc,GAAG,YAAY;IAC/B,IAAIC,QAAQ,GAAG,MAAMT,MAAM,CAACU,cAAP,CAAsBC,WAAtB,EAArB;;IACA,IAAIC,KAAK,CAACC,OAAN,CAAcJ,QAAd,KAA2BA,QAAQ,CAACK,MAAxC,EAAgD;MAC5C,IAAIT,SAAS,GAAGI,QAAQ,CAAC,CAAD,CAAR,CAAYJ,SAA5B;MACA,IAAIU,MAAM,GAAG,MAAMf,MAAM,CAACgB,QAAP,CAAgBC,KAAhB,CAAsB;QACrCC,YAAY,EAAE,cADuB;QAErCC,QAAQ,EAAE,OAF2B;QAGrCC,UAAU,EAAEf;MAHyB,CAAtB,CAAnB;;MAKA,IAAIU,MAAJ,EAAY;QACRX,WAAW,GAAG;UACV;UACAC,SAAS,EAAEA,SAFD;UAGV;UACAC,OAAO,EAAES,MAAM,CAACM,MAJN;UAKVd,UAAU,EAAE,MAAMA,UAAU;QALlB,CAAd;MAOH;IACJ;EACJ,CAnBD;;EAoBA,MAAMC,cAAc,EAApB;EACAR,MAAM,CAACU,cAAP,CAAsBY,EAAtB,CAAyB,QAAzB,EAAmC,YAAY;IAC3C,MAAMd,cAAc,EAApB;;IACA,IAAIJ,WAAJ,EAAiB;MACbmB,QAAQ,CAACC,QAAT,CAAkBC,MAAlB;IACH;EACJ,CALD;EAMAzB,MAAM,CAAC0B,WAAP,GAAqBtB,WAArB;AACH;;AAED,eAAeuB,MAAf,GAAwB;EACpB3B,MAAM,CAACU,cAAP,CAAsBkB,IAAtB;AACH;;AAED,eAAeC,OAAf,GAAyB;EACrB,MAAM7B,MAAM,CAACU,cAAP,CAAsBmB,OAAtB,GAAgCC,IAAhC,CAAqC,MAAM;IAC7CP,QAAQ,CAACC,QAAT,CAAkBC,MAAlB;EACH,CAFK,EAEHM,KAFG,CAEIC,GAAD,IAAS;IACdC,KAAK,CAACD,GAAD,CAAL;EACH,CAJK,CAAN;AAKH;;AAED,eAAezB,UAAf,GAA4B;EACxB,OAAOP,MAAM,CAACU,cAAP,CAAsBH,UAAtB,EAAP;AACH;;AAID,SACIb,IADJ,EAEIiC,MAFJ,EAGIE,OAHJ,EAIItB,UAJJ"},"metadata":{},"sourceType":"module"}