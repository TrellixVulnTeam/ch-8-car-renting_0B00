(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[648],{5787:function(t,r,e){var n=e(7854),o=e(7976),a=n.TypeError;t.exports=function(t,r){if(o(r,t))return t;throw a("Incorrect invocation")}},3678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},2801:function(t,r,e){"use strict";var n=e(2109),o=e(5005),a=e(9114),i=e(3070).f,s=e(2597),c=e(5787),l=e(9587),d=e(6277),_=e(3678),u=e(7741),m=e(1913),p="DOMException",E=o("Error"),w=o(p),R=function(){c(this,h);var t=arguments.length,r=d(t<1?void 0:arguments[0]),e=d(t<2?void 0:arguments[1],"Error"),n=new w(r,e),o=E(r);return o.name=p,i(n,"stack",a(1,u(o.stack,1))),l(n,this,R),n},h=R.prototype=w.prototype,f="stack"in E(p),g="stack"in new w(1,2),C=f&&!g;n({global:!0,forced:m||C},{DOMException:C?R:w});var N=o(p),I=N.prototype;if(I.constructor!==N)for(var y in m||i(I,"constructor",a(1,N)),_)if(s(_,y)){var v=_[y],A=v.s;s(N,A)||i(N,A,a(6,v.c))}},6759:function(t,r,e){"use strict";e.d(r,{D:function(){return a},a:function(){return o}});var n=e(9049);function o(){let t=window.location.search.substring(1);return new URLSearchParams(t)}async function a(t){const r=new n.providers.JsonRpcProvider("https://archival-rpc.testnet.near.org");return await r.txStatus(t,window.nearAccount.accountId)}},736:function(t,r,e){"use strict";e.d(r,{Z:function(){return S}});var n=e(3396),o=e(7139),a=e(9242);const i={class:"col-4 mb-4"},s={class:"card"},c=["src"],l={class:"card-body"},d={class:"card-title"},_={class:"card-text"},u={class:"list-group list-group-flush"},m={class:"list-group-item d-flex justify-content-between"},p=(0,n._)("span",null,"Owner:",-1),E={class:"list-group-item d-flex justify-content-between"},w=(0,n._)("span",null,"Price per month:",-1),R=(0,n.Uk)("Go to car page"),h={key:0},f=(0,n._)("hr",null,null,-1),g={class:"list-group list-group-flush"},C={class:"list-group-item d-flex justify-content-between"},N=(0,n._)("span",null,"Already paid:",-1);function I(t,r,e,I,y,v){const A=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n._)("div",s,[(0,n._)("img",{src:e.image,class:"card-img-top",alt:"...",style:{height:"250px"}},null,8,c),(0,n._)("div",l,[(0,n._)("h5",d,(0,o.zw)(e.title),1),(0,n._)("p",_,(0,o.zw)(e.description),1)]),(0,n._)("ul",u,[(0,n._)("li",m,[p,(0,n._)("span",null,(0,o.zw)(e.owner_id),1)]),(0,n._)("li",E,[w,(0,n._)("span",null,(0,o.zw)(t.$filters.formatYoctoNearToNear(e.price_per_month))+" Ⓝ",1)])]),(0,n.Wm)(A,{to:{name:"car-single",params:{id:e.id}},class:"btn btn-primary"},{default:(0,n.w5)((()=>[R])),_:1},8,["to"]),e.is_rent?((0,n.wg)(),(0,n.iD)("div",h,[f,(0,n._)("ul",g,[(0,n._)("li",C,[N,(0,n._)("span",null,(0,o.zw)(t.$filters.formatYoctoNearToNear(v.alreadyPaid))+" Ⓝ",1)])]),(0,n._)("button",{class:"btn btn-danger w-100",onClick:r[0]||(r[0]=(0,a.iM)(((...t)=>v.startCancelRentCarProcess&&v.startCancelRentCarProcess(...t)),["prevent"]))},"Cancel renting")])):(0,n.kq)("",!0)])])}var y=e(6759),v=(e(5648),{name:"CarListItemComponent",props:["id","title","description","image","owner_id","price_per_month","is_rent","stream_id","rent"],methods:{async continueCancelRentCarProcess(){let t=this.$loading.show(),r=(0,y.a)(),e=r.get("transactionHashes");if(null!==e){let t=await(0,y.D)(e);if("SuccessValue"in t.status){const r=t.transaction.actions[0].FunctionCall.method_name;switch(r){case"stop_stream":this.$swal.fire({icon:"success",title:"Success",text:"Car rent was canceled!",footer:""}),this.cleanGetParams();break}}}t.hide()},cleanGetParams(){window.history.pushState({},document.title,"https://vitaliksokil.github.io/ch-8-car-renting/#/ch-8-car-renting#"+this.$route.fullPath)},async startCancelRentCarProcess(){let t=this.$loading.show();window.walletConnection.account().functionCall({contractId:window.nearConfig.contractName,methodName:"stop_rent_car",args:{car_id:+this.id},gas:"200000000000000"}).then((t=>{window.walletConnection.account().functionCall({contractId:window.roketoContractName,methodName:"stop_stream",args:{stream_id:this.stream_id},gas:"200000000000000",attachedDeposit:1}).then((t=>{console.log(t)}))})),t.hide()}},async mounted(){let t=this.$loading.show();await this.continueCancelRentCarProcess(),t.hide()},computed:{alreadyPaid(){let t=+new Date;console.log(t);let r=new Date;r.setTime(this.rent.timestamp_created.toString().substring(0,13)),console.log(+r);let e=((t-r)/1e3).toFixed();return e*this.rent.tokens_per_sec}}}),A=e(89);const D=(0,A.Z)(v,[["render",I]]);var S=D},812:function(t,r,e){"use strict";e.r(r),e.d(r,{default:function(){return p}});var n=e(3396);const o={class:"site-section p-4"},a={class:"container"},i={class:"row"};function s(t,r,e,s,c,l){const d=(0,n.up)("car-list-item-component");return(0,n.wg)(),(0,n.iD)("section",o,[(0,n._)("div",a,[(0,n._)("div",i,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.cars,((t,r)=>((0,n.wg)(),(0,n.j4)(d,{key:r,id:r,title:t.car.title,description:t.car.description,image:t.car.image,owner_id:t.car.owner_id,price_per_month:t.car.price_per_month,is_rent:"true",stream_id:t.rent.id,already_paid:t.rent.balance,rent:t.rent},null,8,["id","title","description","image","owner_id","price_per_month","stream_id","already_paid","rent"])))),128))])])])}e(2801);var c=e(736),l=e(9049),d=(e(6759),e(5648),e(5361)["Buffer"]),_={name:"MyRentsComponent",components:{CarListItemComponent:c.Z},data(){return{cars:{}}},methods:{async getStream(t){const r=new l.providers.JsonRpcProvider(window.nearConfig.nodeUrl),e=window.btoa(JSON.stringify({stream_id:t})),n=await r.query({request_type:"call_function",finality:"final",account_id:window.roketoContractName,method_name:"get_stream",args_base64:e});return JSON.parse(d.from(n.result).toString())},async getMyCars(){const t=new l.providers.JsonRpcProvider(window.nearConfig.nodeUrl),r=window.btoa(JSON.stringify({renter_account_id:window.nearAccount.accountId})),e=await t.query({request_type:"call_function",finality:"final",account_id:window.nearConfig.contractName,method_name:"get_rents_by_renter_id",args_base64:r});let n=JSON.parse(d.from(e.result).toString());for(const[o,a]of Object.entries(n))a.rent=await this.getStream(a.rent.stream_id);this.cars=n,console.log(n)}},async mounted(){let t=this.$loading.show();await this.getMyCars(),t.hide()}},u=e(89);const m=(0,u.Z)(_,[["render",s]]);var p=m}}]);
//# sourceMappingURL=648.035baf81.js.map