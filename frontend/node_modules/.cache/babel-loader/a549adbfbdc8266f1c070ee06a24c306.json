{"ast":null,"code":"import { getTransactionState, getUrlParams } from \"../../../helpers\";\nimport Big from \"big.js\";\nexport default {\n  name: \"CarListItemComponent\",\n  props: ['id', 'title', 'description', 'image', 'owner_id', 'price_per_month', 'is_rent', 'stream_id'],\n  methods: {\n    async afterStopStream() {\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.nearConfig.contractName,\n        methodName: 'stop_rent_car',\n        args: {\n          \"car_id\": +this.id\n        },\n        gas: \"200000000000000\"\n      }).then(response => {\n        this.$swal.fire({\n          icon: 'success',\n          title: 'Success',\n          text: 'Car rent was canceled!',\n          footer: ``\n        });\n      });\n      loader.hide();\n    },\n\n    async continueCancelRentCarProcess() {\n      let params = getUrlParams();\n      let transactionHashes = params.get('transactionHashes');\n\n      if (transactionHashes !== null) {\n        let result = await getTransactionState(transactionHashes);\n\n        if (\"SuccessValue\" in result.status) {\n          const transactionMethodName = result.transaction.actions[0].FunctionCall.method_name;\n\n          switch (transactionMethodName) {\n            case 'stop_stream':\n              await this.afterStopStream();\n              this.cleanGetParams();\n              break;\n\n            case 'stop_rent_car':\n              this.$swal.fire({\n                icon: 'success',\n                title: 'Success',\n                text: 'Car rent was canceled!',\n                footer: ``\n              });\n              this.cleanGetParams();\n              break;\n          }\n        }\n      }\n    },\n\n    cleanGetParams() {\n      window.history.pushState({}, document.title, process.env.VUE_APP_APP_URL + '#' + this.$route.fullPath);\n    },\n\n    async startCancelRentCarProcess() {\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.roketoContractName,\n        methodName: 'stop_stream',\n        args: {\n          \"stream_id\": this.stream_id\n        },\n        gas: \"200000000000000\",\n        attachedDeposit: 1\n      }).then(response => {\n        console.log(response);\n      });\n      loader.hide();\n    }\n\n  },\n\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.continueCancelRentCarProcess();\n    loader.hide();\n  }\n\n};","map":{"version":3,"mappings":"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","names":["getTransactionState","getUrlParams","Big","name","props","methods","afterStopStream","loader","$loading","show","window","walletConnection","account","functionCall","contractId","nearConfig","contractName","methodName","args","id","gas","then","response","$swal","fire","icon","title","text","footer","hide","continueCancelRentCarProcess","params","transactionHashes","get","result","status","transactionMethodName","transaction","actions","FunctionCall","method_name","cleanGetParams","history","pushState","document","process","env","VUE_APP_APP_URL","$route","fullPath","startCancelRentCarProcess","roketoContractName","stream_id","attachedDeposit","console","log","mounted"],"sourceRoot":"","sources":["/var/www/ch-8-car-renting/frontend/src/components/Pages/CarListItemComponent.vue"],"sourcesContent":["<template>\n  <div class=\"col-4 mb-4\">\n    <div class=\"card\">\n      <img :src=\"image\" class=\"card-img-top\" alt=\"...\" style=\"height: 250px\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">{{ title }}</h5>\n        <p class=\"card-text\">{{description}}</p>\n      </div>\n      <ul class=\"list-group list-group-flush\">\n        <li class=\"list-group-item d-flex justify-content-between\"><span>Owner:</span><span>{{owner_id}}</span></li>\n        <li class=\"list-group-item d-flex justify-content-between\"><span>Price per hour:</span><span>{{$filters.formatYoctoNearToNear(price_per_month)}} Ⓝ</span></li>\n      </ul>\n      <router-link :to=\"{name:'car-single',params:{id:id}}\" class=\"btn btn-primary\">Go to car page</router-link>\n      <div v-if=\"is_rent\">\n        <hr>\n        <ul class=\"list-group list-group-flush\">\n          <li class=\"list-group-item d-flex justify-content-between\"><span>Owner:</span><span>{{owner_id}}</span></li>\n          <li class=\"list-group-item d-flex justify-content-between\"><span>Price per hour:</span><span>{{$filters.formatYoctoNearToNear(price_per_month)}} Ⓝ</span></li>\n        </ul>\n        <button class=\"btn btn-danger w-100\" @click.prevent=\"startCancelRentCarProcess\">Cancel renting</button>\n      </div>\n\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport {getTransactionState, getUrlParams} from \"../../../helpers\";\nimport Big from \"big.js\";\n\nexport default {\n  name: \"CarListItemComponent\",\n  props: [\n    'id',\n    'title',\n    'description',\n    'image',\n    'owner_id',\n    'price_per_month',\n    'is_rent',\n    'stream_id',\n  ],\n  methods:{\n    async afterStopStream(){\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.nearConfig.contractName,\n        methodName: 'stop_rent_car',\n        args: {\"car_id\": +this.id},\n        gas:\"200000000000000\",\n      }).then((response)=>{\n        this.$swal.fire({\n          icon: 'success',\n          title: 'Success',\n          text: 'Car rent was canceled!',\n          footer: ``,\n        });\n      });\n      loader.hide();\n    },\n    async continueCancelRentCarProcess() {\n      let params = getUrlParams();\n      let transactionHashes = params.get('transactionHashes');\n      if (transactionHashes !== null){\n        let result = await getTransactionState(transactionHashes);\n        if (\"SuccessValue\" in result.status){\n          const transactionMethodName = result.transaction.actions[0].FunctionCall.method_name;\n          switch (transactionMethodName){\n            case 'stop_stream':\n              await this.afterStopStream();\n              this.cleanGetParams();\n\n              break;\n            case 'stop_rent_car':\n              this.$swal.fire({\n                icon: 'success',\n                title: 'Success',\n                text: 'Car rent was canceled!',\n                footer: ``,\n              })\n              this.cleanGetParams();\n              break;\n          }\n        }\n      }\n    },\n    cleanGetParams(){\n      window.history.pushState({}, document.title, process.env.VUE_APP_APP_URL + '#' + this.$route.fullPath);\n    },\n    async startCancelRentCarProcess(){\n      let loader = this.$loading.show();\n      window.walletConnection.account().functionCall({\n        contractId: window.roketoContractName,\n        methodName: 'stop_stream',\n        args: {\"stream_id\": this.stream_id},\n        gas:\"200000000000000\",\n        attachedDeposit:1,\n      }).then((response)=>{\n        console.log(response)\n      });\n      loader.hide();\n    },\n  },\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.continueCancelRentCarProcess()\n    loader.hide()\n  }\n\n}\n</script>\n\n<style scoped>\n\n</style>"]},"metadata":{},"sourceType":"module"}