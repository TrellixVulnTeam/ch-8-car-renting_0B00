{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport Big from \"big.js\";\nimport * as nearAPI from \"near-api-js\";\nconst BOATLOAD_OF_GAS = Big(3).times(10 ** 13).toFixed();\nexport default {\n  name: \"SingleCarComponent\",\n  components: {},\n\n  data() {\n    return {\n      currentCar: {}\n    };\n  },\n\n  methods: {\n    async getCurrentCar() {\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({\n        id: +this.$route.params.id\n      }));\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.nearConfig.contractName,\n        method_name: \"get_car_by_id\",\n        args_base64: argsBase64\n      }).catch(() => {\n        this.$router.push({\n          'name': 'home'\n        });\n      });\n      this.currentCar = JSON.parse(Buffer.from(rawResult.result).toString());\n    },\n\n    async buyTicket() {\n      await window.walletSelector.signAndSendTransaction({\n        signerId: window.nearAccount.accountId,\n        // receiverId: nearConfig.contractName,\n        actions: [{\n          type: \"FunctionCall\",\n          params: {\n            methodName: \"buy_ticket\",\n            args: {\n              \"meeting_id\": +this.$route.params.id\n            },\n            gas: BOATLOAD_OF_GAS,\n            deposit: Big((this.currentMeeting.ticket_price / 10 ** 24).toFixed(5)).times(10 ** 24).toFixed()\n          }\n        }]\n      });\n    },\n\n    async buyTicketAction() {\n      let loader = this.$loading.show();\n\n      try {\n        await this.buyTicket();\n        this.$swal.fire({\n          icon: 'success',\n          title: 'Success',\n          text: 'Ticket was successfully bought!',\n          footer: `To look at your ticket go to your wallet collectibles!`\n        });\n        await this.getCurrentMeeting();\n      } catch (error) {\n        this.$swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: error.message,\n          footer: ``\n        });\n        console.log(error);\n      }\n\n      loader.hide();\n    }\n\n  },\n\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.getCurrentCar();\n    loader.hide(); //\n    // let uri = window.location.search.substring(1);\n    // let params = new URLSearchParams(uri);\n    // const transactionHash = params.get('transactionHashes');\n    // if(transactionHash){\n    //   this.$swal.fire({\n    //     icon: 'success',\n    //     title: 'Success',\n    //     text: 'Ticket was successfully bought!',\n    //     footer: `To look at your ticket go to your wallet collectibles!`,\n    //   })\n    // }\n  }\n\n};","map":{"version":3,"mappings":"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","names":["Big","nearAPI","BOATLOAD_OF_GAS","times","toFixed","name","components","data","currentCar","methods","getCurrentCar","provider","providers","JsonRpcProvider","window","nearConfig","nodeUrl","argsBase64","btoa","JSON","stringify","id","$route","params","rawResult","query","request_type","finality","account_id","contractName","method_name","args_base64","catch","$router","push","parse","Buffer","from","result","toString","buyTicket","walletSelector","signAndSendTransaction","signerId","nearAccount","accountId","actions","type","methodName","args","gas","deposit","currentMeeting","ticket_price","buyTicketAction","loader","$loading","show","$swal","fire","icon","title","text","footer","getCurrentMeeting","error","message","console","log","hide","mounted"],"sourceRoot":"","sources":["/var/www/ch-8-car-renting/frontend/src/components/Pages/SingleCarComponent.vue"],"sourcesContent":["<template>\n  <div class=\"site-section p-4\">\n    <div class=\"container\">\n      <div class=\"p-4 p-md-5 mb-4 text-white rounded bg-dark\">\n        <div class=\"row\">\n          <div class=\"col-6 px-0 d-flex\">\n            <div>\n              <h1 class=\"display-4 fst-italic\">{{ currentCar.title }}</h1>\n              <p class=\"lead my-3\">{{ currentCar.description }}</p>\n              <hr>\n            </div>\n            <div>\n              <p class=\"d-flex justify-content-between\"><span>Owner:</span><span>{{currentCar.owner_id}}</span></p>\n              <p class=\"d-flex justify-content-between\"><span>Price per hour:</span><span>{{$filters.formatYoctoNearToNear(currentCar.price_per_hour)}} Ⓝ</span></p>\n              <button class=\"btn btn-primary\">Rent car</button>\n            </div>\n          </div>\n          <div class=\"col-6\">\n            <img :src=\"currentCar.image\" alt=\"Image\" class=\"img-fluid\" style=\"width: 100%\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"row mb-5 align-items-st\">\n        <div class=\"col-md-5\">\n          <div class=\"heading-20219\">\n            <h2 class=\"title text-cursive mb-4\"></h2>\n            <p>{{ currentCar.description }}</p>\n            <p>\n              <button class=\"btn btn-primary rounded-0 px-4\" @click.prevent=\"buyTicketAction\"\n                      :disabled=\"currentCar.is_rented\">Rent car\n              </button>\n            </p>\n          </div>\n        </div>\n        <div class=\"col-md-7\">\n          <div class=\"cause shadow-sm\">\n\n            <a class=\"cause-link d-block\">\n              <img :src=\"currentCar.image\" alt=\"Image\" class=\"img-fluid\">\n            </a>\n\n            <div class=\"px-3 pt-3 border-top-0 border border shadow-sm\">\n              <h3 class=\"mb-4\">{{ currentCar.title }}</h3>\n              <div class=\"border-top border-light border-bottom py-2 d-flex justify-content-between\">\n                <div>Ticket price</div>\n                <div class=\"ml-auto\"><strong\n                    class=\"text-success\">{{ $filters.formatYoctoNearToNear(currentCar.price_per_hour) }} Ⓝ</strong>\n                </div>\n              </div>\n\n              <div class=\"py-4\">\n                <div class=\"d-flex align-items-center\">\n                  <div class=\"\">{{ currentCar.owner_id }}</div>\n                </div>\n              </div>\n            </div>\n\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n</template>\n\n<script>\nimport Big from \"big.js\";\nimport * as nearAPI from \"near-api-js\";\n\nconst BOATLOAD_OF_GAS = Big(3).times(10 ** 13).toFixed();\n\nexport default {\n  name: \"SingleCarComponent\",\n  components: {},\n  data() {\n    return {\n      currentCar: {},\n    }\n  },\n  methods: {\n    async getCurrentCar() {\n      const provider = new nearAPI.providers.JsonRpcProvider(window.nearConfig.nodeUrl);\n      const argsBase64 = window.btoa(JSON.stringify({id: +this.$route.params.id}))\n      const rawResult = await provider.query({\n        request_type: \"call_function\",\n        finality: \"final\",\n        account_id: window.nearConfig.contractName,\n        method_name: \"get_car_by_id\",\n        args_base64: argsBase64,\n      }).catch(() => {\n        this.$router.push({'name': 'home'});\n      });\n      this.currentCar = JSON.parse(Buffer.from(rawResult.result).toString())\n    },\n\n    async buyTicket() {\n      await window.walletSelector.signAndSendTransaction({\n        signerId: window.nearAccount.accountId,\n        // receiverId: nearConfig.contractName,\n        actions: [\n          {\n            type: \"FunctionCall\",\n            params: {\n              methodName: \"buy_ticket\",\n              args: {\n                \"meeting_id\": +this.$route.params.id,\n              },\n              gas: BOATLOAD_OF_GAS,\n              deposit: Big((this.currentMeeting.ticket_price / (10 ** 24)).toFixed(5)).times(10 ** 24).toFixed()\n            },\n          },\n        ]\n      });\n    },\n\n    async buyTicketAction() {\n      let loader = this.$loading.show();\n      try {\n        await this.buyTicket();\n        this.$swal.fire({\n          icon: 'success',\n          title: 'Success',\n          text: 'Ticket was successfully bought!',\n          footer: `To look at your ticket go to your wallet collectibles!`,\n        })\n        await this.getCurrentMeeting();\n      } catch (error) {\n        this.$swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: error.message,\n          footer: ``,\n        })\n        console.log(error)\n      }\n      loader.hide();\n\n    }\n  },\n  async mounted() {\n    let loader = this.$loading.show();\n    await this.getCurrentCar();\n    loader.hide();\n    //\n    // let uri = window.location.search.substring(1);\n    // let params = new URLSearchParams(uri);\n    // const transactionHash = params.get('transactionHashes');\n    // if(transactionHash){\n    //   this.$swal.fire({\n    //     icon: 'success',\n    //     title: 'Success',\n    //     text: 'Ticket was successfully bought!',\n    //     footer: `To look at your ticket go to your wallet collectibles!`,\n    //   })\n    // }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>"]},"metadata":{},"sourceType":"module"}